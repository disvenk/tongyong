<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.resto.service.shop.mapper.OrderMapper">

    <resultMap id="BaseResultMap" type="com.resto.service.shop.entity.Order">
        <id column="id" property="id" jdbcType="VARCHAR"/>
        <result column="table_number" property="tableNumber" jdbcType="VARCHAR"/>
        <result column="customer_count" property="customerCount" jdbcType="INTEGER"/>
        <result column="accounting_time" property="accountingTime" jdbcType="DATE"/>
        <result column="order_state" property="orderState" jdbcType="INTEGER"/>
        <result column="production_status" property="productionStatus"  jdbcType="INTEGER"/>
        <result column="original_amount" property="originalAmount" jdbcType="DECIMAL"/>
        <result column="reduction_amount" property="reductionAmount" jdbcType="DECIMAL"/>
        <result column="payment_amount" property="paymentAmount"  jdbcType="DECIMAL"/>
        <result column="order_money" property="orderMoney" jdbcType="DECIMAL"/>
        <result column="ali_pay_discount_money" property="aliPayDiscountMoney"/>
        <result column="article_count" property="articleCount" jdbcType="INTEGER"/>
        <result column="serial_number" property="serialNumber" jdbcType="VARCHAR"/>
        <result column="confirm_time" property="confirmTime" jdbcType="TIMESTAMP"/>
        <result column="print_times" property="printTimes" jdbcType="INTEGER"/>
        <result column="allow_cancel" property="allowCancel" jdbcType="BIT"/>
        <result column="allow_appraise" property="allowAppraise"  jdbcType="BIT"/>
        <result column="closed" property="closed" jdbcType="BIT"/>
        <result column="remark" property="remark" jdbcType="VARCHAR"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="operator_id" property="operatorId" jdbcType="VARCHAR"/>
        <result column="customer_id" property="customerId" jdbcType="VARCHAR"/>
        <result column="customer_address_id" property="customerAddressId" jdbcType="VARCHAR"/>
        <result column="distribution_date" property="distributionDate"  jdbcType="DATE"/>
        <result column="distribution_time_id" property="distributionTimeId"  jdbcType="INTEGER"/>
        <result column="delivery_point_id" property="deliveryPointId"  jdbcType="INTEGER"/>
        <result column="shop_detail_id" property="shopDetailId"  jdbcType="VARCHAR"/>
        <result column="distribution_mode_id" property="distributionModeId"  jdbcType="INTEGER"/>
        <result column="ver_code" property="verCode" jdbcType="VARCHAR"/>
        <result column="push_order_time" property="pushOrderTime" jdbcType="TIMESTAMP"/>
        <result column="print_order_time" property="printOrderTime"  jdbcType="TIMESTAMP"/>
        <result column="call_number_time" property="callNumberTime" jdbcType="TIMESTAMP"/>
        <result column="order_mode" property="orderMode" jdbcType="INTEGER"/>
        <result column="brand_id" property="brandId" jdbcType="VARCHAR"/>
        <result column="amount_with_children" property="amountWithChildren" jdbcType="DECIMAL"/>
        <result column="parent_order_id" property="parentOrderId" jdbcType="VARCHAR"/>
        <result column="allow_continue_order" property="allowContinueOrder"  jdbcType="BIT"/>
        <result column="count_with_child" property="countWithChild" jdbcType="INTEGER"/>
        <result column="last_order_time" property="lastOrderTime"  jdbcType="TIMESTAMP"/>
        <result column="orderCount" property="orderCount"/>
        <result column="orderTotal" property="orderTotal"/>
        <result column="service_price" property="servicePrice"/>
        <result column="pay_mode" property="payMode"/>
        <result column="base_money" property="baseMoney"/>
        <result column="base_order_money" property="baseOrderMoney"/>
        <result column="base_customer_count" property="baseCustomerCount"/>
        <result column="meal_fee_price" property="mealFeePrice"/>
        <result column="meal_all_number" property="mealAllNumber"/>
        <result column="is_pay" property="isPay"/>
        <result column="base_meal_all_count" property="baseMealAllCount"/>
        <result column="pay_type" property="payType"/>
        <result column="is_refund_order" property="isRefundOrder"/>
        <result column="is_get_share_coupon" property="isGetShareCoupon"/>
        <result column="is_pos_pay" property="isPosPay"/>
        <result column="print_fail_flag" property="printFailFlag"/>
        <result column="print_kitchen_flag" property="printKitchenFlag"/>
        <result column="pos_discount" property="posDiscount"/>
        <result column="erase_money" property="eraseMoney"/>
        <result column="no_discount_money" property="noDiscountMoney"/>
        <result column="is_consumption_rebate" property="isConsumptionRebate"/>
        <collection property="orderPaymentItems" ofType="com.resto.service.shop.entity.OrderPaymentItem" javaType="List">
            <id column="order_payment_id" property="id"/>
            <result column="pay_value" property="payValue"/>
            <result column="payment_mode_id" property="paymentModeId"/>
            <result column="result_data" property="resultData"/>
            <result column="pay_time" property="payTime"/>
        </collection>
        <collection property="orderItems" ofType="com.resto.service.shop.entity.OrderItem" javaType="List">
            <id column="order_item_id" property="id"/>
            <result column="article_name" property="articleName"/>
            <result column="article_id" property="articleId"/>
            <result column="count" property="count"/>
            <result column="original_price" property="originalPrice"/>
            <result column="unit_price" property="unitPrice"/>
            <result column="original_count" property="orginCount"/>
            <result column="refund_count" property="refundCount"/>
            <result column="type" property="type"/>
        </collection>
    </resultMap>
    
    <sql id="Base_Column_List">
        id, table_number, customer_count, accounting_time,
        order_state,
        production_status,
        original_amount, reduction_amount,
        payment_amount, order_money, ali_pay_discount_money, article_count,
        serial_number,
        confirm_time, print_times, allow_cancel, allow_appraise, closed,
        remark,
        create_time,
        operator_id, customer_id,customer_address_id, distribution_date,
        distribution_time_id,
        delivery_point_id,
        shop_detail_id,
        distribution_mode_id, ver_code, push_order_time, print_order_time,
        call_number_time, order_mode, brand_id, amount_with_children,
        parent_order_id, allow_continue_order,
        count_with_child,
        last_order_time,customer_count,service_price,pay_mode,base_money,base_order_money,base_customer_count,meal_fee_price,meal_all_number
        ,is_pay,need_scan, base_meal_all_count, pay_type,is_confirm, is_refund_order, is_get_share_coupon, give_change, is_pos_pay,
        print_fail_flag,print_kitchen_flag, pos_discount, erase_money, no_discount_money, is_consumption_rebate
    </sql>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap"
            parameterType="java.lang.String">
        select
        <include refid="Base_Column_List"/>
        ,ifnull(count_with_child,article_count) as
        totalCount
        from tb_order
        where id = #{id,jdbcType=VARCHAR}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
        delete from
        tb_order
        where id = #{id,jdbcType=VARCHAR}
    </delete>
    <insert id="insert" parameterType="com.resto.service.shop.entity.Order">
        insert into tb_order (id,
        table_number, customer_count,
        accounting_time, order_state,
        production_status,
        original_amount, reduction_amount, payment_amount,
        order_money, article_count, serial_number,
        confirm_time, print_times,
        allow_cancel,
        allow_appraise, closed, remark,
        create_time, operator_id,
        customer_id,
        distribution_date, distribution_time_id,
        delivery_point_id,
        shop_detail_id, distribution_mode_id, ver_code,
        push_order_time, print_order_time, call_number_time,
        order_mode,
        brand_id, amount_with_children,
        parent_order_id, allow_continue_order,
        count_with_child,
        last_order_time, pay_type, is_get_share_coupon,give_change,is_pos_pay)
        values (#{id,jdbcType=VARCHAR},
        #{tableNumber,jdbcType=VARCHAR},
        #{customerCount,jdbcType=INTEGER},
        #{accountingTime,jdbcType=DATE}, #{orderState,jdbcType=INTEGER},
        #{productionStatus,jdbcType=INTEGER},
        #{originalAmount,jdbcType=DECIMAL},
        #{reductionAmount,jdbcType=DECIMAL},
        #{paymentAmount,jdbcType=DECIMAL},
        #{orderMoney,jdbcType=DECIMAL},
        #{articleCount,jdbcType=INTEGER}, #{serialNumber,jdbcType=VARCHAR},
        #{confirmTime,jdbcType=TIMESTAMP}, #{printTimes,jdbcType=INTEGER},
        #{allowCancel,jdbcType=BIT},
        #{allowAppraise,jdbcType=BIT},
        #{closed,jdbcType=BIT}, #{remark,jdbcType=VARCHAR},
        #{createTime,jdbcType=TIMESTAMP}, #{operatorId,jdbcType=VARCHAR},
        #{customerId,jdbcType=VARCHAR},
        #{distributionDate,jdbcType=DATE},
        #{distributionTimeId,jdbcType=INTEGER},
        #{deliveryPointId,jdbcType=INTEGER},
        #{shopDetailId,jdbcType=VARCHAR},
        #{distributionModeId,jdbcType=INTEGER}, #{verCode,jdbcType=VARCHAR},
        #{pushOrderTime,jdbcType=TIMESTAMP},
        #{printOrderTime,jdbcType=TIMESTAMP},
        #{callNumberTime,jdbcType=TIMESTAMP},
        #{orderMode,jdbcType=INTEGER},
        #{brandId,jdbcType=VARCHAR}, #{amountWithChildren,jdbcType=DECIMAL},
        #{parentOrderId,jdbcType=VARCHAR}, #{allowContinueOrder,jdbcType=BIT},
        #{countWithChild,jdbcType=INTEGER},
        #{lastOrderTime,jdbcType=TIMESTAMP},
        #{payType},#{isGetShareCoupon},#{giveChange},#{isPosPay})
    </insert>
    <insert id="insertSelective" parameterType="com.resto.service.shop.entity.Order">
        insert into tb_order
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="tableNumber != null">
                table_number,
            </if>
            <if test="customerCount != null">
                customer_count,
            </if>
            <if test="accountingTime != null">
                accounting_time,
            </if>
            <if test="orderState != null">
                order_state,
            </if>
            <if test="productionStatus != null">
                production_status,
            </if>
            <if test="originalAmount != null">
                original_amount,
            </if>
            <if test="reductionAmount != null">
                reduction_amount,
            </if>
            <if test="paymentAmount != null">
                payment_amount,
            </if>
            <if test="orderMoney != null">
                order_money,
            </if>
            <if test="articleCount != null">
                article_count,
            </if>
            <if test="serialNumber != null">
                serial_number,
            </if>
            <if test="confirmTime != null">
                confirm_time,
            </if>
            <if test="printTimes != null">
                print_times,
            </if>
            <if test="allowCancel != null">
                allow_cancel,
            </if>
            <if test="allowAppraise != null">
                allow_appraise,
            </if>
            <if test="closed != null">
                closed,
            </if>
            <if test="remark != null">
                remark,
            </if>
            <if test="createTime != null">
                create_time,
            </if>
            <if test="operatorId != null">
                operator_id,
            </if>
            <if test="customerId != null">
                customer_id,
            </if>
            <if test="customerAddressId != null">
                customer_address_id,
            </if>
            <if test="distributionDate != null">
                distribution_date,
            </if>
            <if test="distributionTimeId != null">
                distribution_time_id,
            </if>
            <if test="deliveryPointId != null">
                delivery_point_id,
            </if>
            <if test="shopDetailId != null">
                shop_detail_id,
            </if>
            <if test="distributionModeId != null">
                distribution_mode_id,
            </if>
            <if test="verCode != null">
                ver_code,
            </if>
            <if test="pushOrderTime != null">
                push_order_time,
            </if>
            <if test="printOrderTime != null">
                print_order_time,
            </if>
            <if test="callNumberTime != null">
                call_number_time,
            </if>
            <if test="orderMode != null">
                order_mode,
            </if>
            <if test="brandId != null">
                brand_id,
            </if>
            <if test="amountWithChildren != null">
                amount_with_children,
            </if>
            <if test="parentOrderId != null">
                parent_order_id,
            </if>
            <if test="allowContinueOrder != null">
                allow_continue_order,
            </if>
            <if test="countWithChild != null">
                count_with_child,
            </if>
            <if test="lastOrderTime != null">
                last_order_time,
            </if>
            <if test="servicePrice != null">
                service_price,
            </if>
            <if test="payMode != null">
                pay_mode,
            </if>
            <if test="orderMoney != null">
                base_money,
            </if>
            <if test="customerCount != null">
                base_customer_count,
            </if>
            <if test="mealFeePrice != null">
                meal_fee_price,
            </if>
            <if test="mealAllNumber != null">
                meal_all_number,
            </if>
            <if test="needScan != null">
                need_scan,
            </if>
            <if test="mealAllNumber != null">
                base_meal_all_count,
            </if>
            <if test="payType != null">
                pay_type,
            </if>
            <if test="isRefundOrder != null">
                is_refund_order,
            </if>
            <if test="isGetShareCoupon != null">
                is_get_share_coupon,
            </if>
            <if test="giveChange != null">
                give_change,
            </if>
            <if test="isPosPay != null">
                is_pos_pay,
            </if>
            <if test="printFailFlag != null">
                print_fail_flag,
            </if>
            <if test="printKitchenFlag != null">
                print_kitchen_flag,
            </if>
            <if test="posDiscount != null">
                pos_discount,
            </if>
            <if test="isConsumptionRebate != null">
                is_consumption_rebate,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=VARCHAR},
            </if>
            <if test="tableNumber != null">
                #{tableNumber,jdbcType=VARCHAR},
            </if>
            <if test="customerCount != null">
                #{customerCount,jdbcType=INTEGER},
            </if>
            <if test="accountingTime != null">
                #{accountingTime,jdbcType=DATE},
            </if>
            <if test="orderState != null">
                #{orderState,jdbcType=INTEGER},
            </if>
            <if test="productionStatus != null">
                #{productionStatus,jdbcType=INTEGER},
            </if>
            <if test="originalAmount != null">
                #{originalAmount,jdbcType=DECIMAL},
            </if>
            <if test="reductionAmount != null">
                #{reductionAmount,jdbcType=DECIMAL},
            </if>
            <if test="paymentAmount != null">
                #{paymentAmount,jdbcType=DECIMAL},
            </if>
            <if test="orderMoney != null">
                #{orderMoney,jdbcType=DECIMAL},
            </if>
            <if test="articleCount != null">
                #{articleCount,jdbcType=INTEGER},
            </if>
            <if test="serialNumber != null">
                #{serialNumber,jdbcType=VARCHAR},
            </if>
            <if test="confirmTime != null">
                #{confirmTime,jdbcType=TIMESTAMP},
            </if>
            <if test="printTimes != null">
                #{printTimes,jdbcType=INTEGER},
            </if>
            <if test="allowCancel != null">
                #{allowCancel,jdbcType=BIT},
            </if>
            <if test="allowAppraise != null">
                #{allowAppraise,jdbcType=BIT},
            </if>
            <if test="closed != null">
                #{closed,jdbcType=BIT},
            </if>
            <if test="remark != null">
                #{remark,jdbcType=VARCHAR},
            </if>
            <if test="createTime != null">
                #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="operatorId != null">
                #{operatorId,jdbcType=VARCHAR},
            </if>
            <if test="customerId != null">
                #{customerId,jdbcType=VARCHAR},
            </if>
            <if test="customerAddressId != null">

                #{customerAddressId,jdbcType=VARCHAR},
            </if>
            <if test="distributionDate != null">
                #{distributionDate,jdbcType=DATE},
            </if>
            <if test="distributionTimeId != null">
                #{distributionTimeId,jdbcType=INTEGER},
            </if>
            <if test="deliveryPointId != null">
                #{deliveryPointId,jdbcType=INTEGER},
            </if>
            <if test="shopDetailId != null">
                #{shopDetailId,jdbcType=VARCHAR},
            </if>
            <if test="distributionModeId != null">
                #{distributionModeId,jdbcType=INTEGER},
            </if>
            <if test="verCode != null">
                #{verCode,jdbcType=VARCHAR},
            </if>
            <if test="pushOrderTime != null">
                #{pushOrderTime,jdbcType=TIMESTAMP},
            </if>
            <if test="printOrderTime != null">
                #{printOrderTime,jdbcType=TIMESTAMP},
            </if>
            <if test="callNumberTime != null">
                #{callNumberTime,jdbcType=TIMESTAMP},
            </if>
            <if test="orderMode != null">
                #{orderMode,jdbcType=INTEGER},
            </if>
            <if test="brandId != null">
                #{brandId,jdbcType=VARCHAR},
            </if>
            <if test="amountWithChildren != null">
                #{amountWithChildren,jdbcType=DECIMAL},
            </if>
            <if test="parentOrderId != null">
                #{parentOrderId,jdbcType=VARCHAR},
            </if>
            <if test="allowContinueOrder != null">
                #{allowContinueOrder,jdbcType=BIT},
            </if>
            <if test="countWithChild != null">
                #{countWithChild,jdbcType=INTEGER},
            </if>
            <if test="lastOrderTime != null">
                #{lastOrderTime,jdbcType=TIMESTAMP},
            </if>
            <if test="servicePrice != null">
                #{servicePrice,jdbcType=DECIMAL},
            </if>
            <if test="payMode != null">
                #{payMode},
            </if>
            <if test="orderMoney != null">
                #{orderMoney},
            </if>
            <if test="customerCount != null">
                #{customerCount},
            </if>
            <if test="mealFeePrice != null">
                #{mealFeePrice},
            </if>
            <if test="mealAllNumber != null">
                #{mealAllNumber},
            </if>
            <if test="needScan != null">
                #{needScan},
            </if>
            <if test="mealAllNumber != null">
                #{mealAllNumber},
            </if>
            <if test="payType != null">
                #{payType},
            </if>
            <if test="isRefundOrder != null">
                #{isRefundOrder},
            </if>
            <if test="isGetShareCoupon != null">
                #{isGetShareCoupon},
            </if>
            <if test="giveChange != null">
                #{giveChange},
            </if>
            <if test="isPosPay != null">
                #{isPosPay},
            </if>
            <if test="printFailFlag != null">
                #{printFailFlag},
            </if>
            <if test="printKitchenFlag != null">
                #{printKitchenFlag},
            </if>
            <if test="posDiscount != null">
                #{posDiscount},
            </if>
            <if test="isConsumptionRebate != null">
                #{isConsumptionRebate},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.resto.service.shop.entity.Order">
        update tb_order
        <set>
            <if test="tableNumber != null">
                table_number = #{tableNumber,jdbcType=VARCHAR},
            </if>
            <if test="customerCount != null">
                customer_count = #{customerCount,jdbcType=INTEGER},
            </if>
            <if test="accountingTime != null">
                accounting_time = #{accountingTime,jdbcType=DATE},
            </if>
            <if test="orderState != null">
                order_state = #{orderState,jdbcType=INTEGER},
            </if>
            <if test="productionStatus != null">
                production_status = #{productionStatus,jdbcType=INTEGER},
            </if>
            <if test="originalAmount != null">
                original_amount = #{originalAmount,jdbcType=DECIMAL},
            </if>
            <if test="reductionAmount != null">
                reduction_amount = #{reductionAmount,jdbcType=DECIMAL},
            </if>
            <if test="paymentAmount != null">
                payment_amount = #{paymentAmount,jdbcType=DECIMAL},
            </if>
            <if test="orderMoney != null">
                order_money = #{orderMoney,jdbcType=DECIMAL},
            </if>
            <if test="aliPayDiscountMoney != null">
                ali_pay_discount_money = #{aliPayDiscountMoney,jdbcType=DECIMAL},
            </if>
            <if test="articleCount != null">
                article_count = #{articleCount,jdbcType=INTEGER},
            </if>
            <if test="serialNumber != null">
                serial_number = #{serialNumber,jdbcType=VARCHAR},
            </if>
            <if test="confirmTime != null">
                confirm_time = #{confirmTime,jdbcType=TIMESTAMP},
            </if>
            <if test="printTimes != null">
                print_times = #{printTimes,jdbcType=INTEGER},
            </if>
            <if test="allowCancel != null">
                allow_cancel = #{allowCancel,jdbcType=BIT},
            </if>
            <if test="allowAppraise != null">
                allow_appraise = #{allowAppraise,jdbcType=BIT},
            </if>
            <if test="closed != null">
                closed = #{closed,jdbcType=BIT},
            </if>
            <if test="remark != null">
                remark = #{remark,jdbcType=VARCHAR},
            </if>
            <if test="createTime != null">
                create_time = #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="operatorId != null">
                operator_id = #{operatorId,jdbcType=VARCHAR},
            </if>
            <if test="customerId != null">
                customer_id = #{customerId,jdbcType=VARCHAR},
            </if>
            <if test="distributionDate != null">
                distribution_date = #{distributionDate,jdbcType=DATE},
            </if>
            <if test="distributionTimeId != null">
                distribution_time_id =
                #{distributionTimeId,jdbcType=INTEGER},
            </if>
            <if test="deliveryPointId != null">
                delivery_point_id = #{deliveryPointId,jdbcType=INTEGER},
            </if>
            <if test="shopDetailId != null">
                shop_detail_id = #{shopDetailId,jdbcType=VARCHAR},
            </if>
            <if test="distributionModeId != null">
                distribution_mode_id =
                #{distributionModeId,jdbcType=INTEGER},
            </if>
            <if test="verCode != null">
                ver_code = #{verCode,jdbcType=VARCHAR},
            </if>
            <if test="pushOrderTime != null">
                push_order_time = #{pushOrderTime,jdbcType=TIMESTAMP},
            </if>
            <if test="printOrderTime != null">
                print_order_time = #{printOrderTime,jdbcType=TIMESTAMP},
            </if>
            <if test="callNumberTime != null">
                call_number_time = #{callNumberTime,jdbcType=TIMESTAMP},
            </if>
            <if test="orderMode != null">
                order_mode = #{orderMode,jdbcType=INTEGER},
            </if>
            <if test="brandId != null">
                brand_id = #{brandId,jdbcType=VARCHAR},
            </if>
            <if test="amountWithChildren != null">
                amount_with_children =
                #{amountWithChildren,jdbcType=DECIMAL},
            </if>
            <if test="parentOrderId != null">
                parent_order_id = #{parentOrderId,jdbcType=VARCHAR},
            </if>
            <if test="allowContinueOrder != null">
                allow_continue_order =
                #{allowContinueOrder,jdbcType=BIT},
            </if>
            <if test="countWithChild != null">
                count_with_child = #{countWithChild,jdbcType=INTEGER},
            </if>
            <if test="lastOrderTime != null">
                last_order_time = #{lastOrderTime,jdbcType=TIMESTAMP},
            </if>
            <if test="servicePrice != null">
                service_price = #{servicePrice},
            </if>
            <if test="mealFeePrice != null">
                meal_fee_price = #{mealFeePrice},
            </if>
            <if test="mealAllNumber != null">
                meal_all_number = #{mealAllNumber},
            </if>
            <if test="isPay != null">
                is_pay = #{isPay},
            </if>
            <if test="payType != null">
                pay_type = #{payType},
            </if>
            <if test="payMode != null">
                pay_mode = #{payMode},
            </if>
            <if test="isRefundOrder != null">
                is_refund_order = #{isRefundOrder},
            </if>
            <if test="isGetShareCoupon != null">
                is_get_share_coupon = #{isGetShareCoupon},
            </if>
            <if test="isPosPay != null">
                is_pos_pay = #{isPosPay},
            </if>
            <if test="baseCustomerCount != null">
                base_customer_count = #{baseCustomerCount},
            </if>
            <if test="giveChange != null">
                give_change = #{giveChange},
            </if>
            <if test="printFailFlag != null">
                print_fail_flag = #{printFailFlag},
            </if>
            <if test="printKitchenFlag != null">
                print_kitchen_flag = #{printKitchenFlag},
            </if>
            <if test="posDiscount != null">
                pos_discount = #{posDiscount},
            </if>
            <if test="eraseMoney != null">
                erase_money = #{eraseMoney},
            </if>
            <if test="noDiscountMoney != null">
                no_discount_money = #{noDiscountMoney},
            </if>
            <if test="baseOrderMoney != null">
                base_order_money = #{baseOrderMoney},
            </if>
            <if test="isConsumptionRebate != null">
                is_consumption_rebate = #{isConsumptionRebate},
            </if>
        </set>
        where id = #{id,jdbcType=VARCHAR}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.resto.service.shop.entity.Order">
        update tb_order
        set table_number = #{tableNumber,jdbcType=VARCHAR},
        customer_count = #{customerCount,jdbcType=INTEGER},
        accounting_time = #{accountingTime,jdbcType=DATE},
        order_state = #{orderState,jdbcType=INTEGER},
        production_status = #{productionStatus,jdbcType=INTEGER},
        original_amount = #{originalAmount,jdbcType=DECIMAL},
        reduction_amount = #{reductionAmount,jdbcType=DECIMAL},
        payment_amount = #{paymentAmount,jdbcType=DECIMAL},
        order_money = #{orderMoney,jdbcType=DECIMAL},
        article_count = #{articleCount,jdbcType=INTEGER},
        serial_number = #{serialNumber,jdbcType=VARCHAR},
        confirm_time = #{confirmTime,jdbcType=TIMESTAMP},
        print_times = #{printTimes,jdbcType=INTEGER},
        allow_cancel = #{allowCancel,jdbcType=BIT},
        allow_appraise = #{allowAppraise,jdbcType=BIT},
        closed = #{closed,jdbcType=BIT},
        remark = #{remark,jdbcType=VARCHAR},
        create_time = #{createTime,jdbcType=TIMESTAMP},
        operator_id = #{operatorId,jdbcType=VARCHAR},
        customer_id = #{customerId,jdbcType=VARCHAR},
        distribution_date = #{distributionDate,jdbcType=DATE},
        distribution_time_id = #{distributionTimeId,jdbcType=INTEGER},
        delivery_point_id = #{deliveryPointId,jdbcType=INTEGER},
        shop_detail_id = #{shopDetailId,jdbcType=VARCHAR},
        distribution_mode_id = #{distributionModeId,jdbcType=INTEGER},
        ver_code = #{verCode,jdbcType=VARCHAR},
        push_order_time = #{pushOrderTime,jdbcType=TIMESTAMP},
        print_order_time = #{printOrderTime,jdbcType=TIMESTAMP},
        call_number_time = #{callNumberTime,jdbcType=TIMESTAMP},
        order_mode = #{orderMode,jdbcType=INTEGER},
        brand_id = #{brandId,jdbcType=VARCHAR},
        amount_with_children = #{amountWithChildren,jdbcType=DECIMAL},
        parent_order_id = #{parentOrderId,jdbcType=VARCHAR},
        allow_continue_order = #{allowContinueOrder,jdbcType=BIT},
        count_with_child = #{countWithChild,jdbcType=INTEGER},
        last_order_time = #{lastOrderTime,jdbcType=TIMESTAMP},
        pay_type = #{payType},is_refund_order = #{isRefundOrder},is_get_share_coupon = #{isGetShareCoupon},is_pos_pay = #{isPosPay}
        where id = #{id,jdbcType=VARCHAR}
    </update>

    <select id="selectList" resultType="Order">select * from tb_order</select>

    <!-- 根据 店铺ID 和 用户ID 分页查询订单列表 -->
    <select id="orderList" resultType="Order">
        SELECT * from tb_order where shop_detail_id = #{shopId} and
        customer_id = #{customerId}
        and ( (order_state != 1 and parent_order_id is null and order_mode != 5)
        or (order_state = 1 and order_mode != 5 and parent_order_id is null)
        or (order_mode = 5 and parent_order_id is null)
        or (parent_order_id is not null and pay_mode in(1,2,3,4) and order_state = 1)
        ) and is_refund_order = 0
        <if test="orderState != null and orderState != '' ">
            and ORDER_STATE in
            <foreach collection="orderState" item="state" open="("
                     separator="," close=")">
                #{state}
            </foreach>
        </if>
        ORDER BY create_time DESC LIMIT
        #{start},#{datalength}
    </select>

    <select id="selectReadyList" resultType="Order">
        SELECT o.id,nickname as
        remark,o.print_order_time,o.ver_code as verCode FROM tb_order o LEFT JOIN
        tb_customer c
        ON
        o.customer_id=c.id
        WHERE production_status=2 and shop_detail_id=#{0}
        and o.order_state in (2,10)
        and DATE_FORMAT(o.create_time,'%Y-%m-%d') = DATE_FORMAT(NOW(),'%Y-%m-%d')
        and closed=0 ORDER BY print_order_time
    </select>

    <!-- 根据订单查询 订单状态 和 生产状态 -->
    <select id="selectOrderStatesById" resultType="Order">
        SELECT
        id,order_state,production_status,allow_continue_order,allow_cancel,allow_appraise
        from tb_order where id = #{orderId}
    </select>

    <select id="selectByParentId" resultType="Order">
        select * from tb_order
        where parent_order_id=#{parentOrderId}
        and order_state != 9
        <if test="parentOrderPayType == 0">
            and order_state != 1
        </if>
    </select>

    <select id="selectPayBefore" resultType="java.math.BigDecimal">
        select sum(pay_value) from tb_order_payment_item
        where order_id = #{orderId} and payment_mode_id not in (13,14,15,20,21)
    </select>

    <select id="selectParentAmountByBossOrder" resultType="java.lang.Double">
        SELECT
        SUM(order_money) FROM tb_order WHERE id=#{orderId} OR parent_order_id=#{orderId}
        and order_state != 9
    </select>

    <select id="selectArticleCountByIdBossOrder" resultType="Integer">
        select
        sum(article_count) from tb_order WHERE id=#{id} OR
        parent_order_id=#{id} and order_state != 9
    </select>

    <select id="selectParentAmount" resultType="java.lang.Double">
        SELECT
        SUM(order_money) FROM tb_order WHERE id=#{orderId} OR parent_order_id=#{orderId}
        <if test="shopMode != 5">
            and order_state not in (1,9)
        </if>
        <if test="shopMode == 5">
            and order_state != 9
        </if>
    </select>

    <select id="selectArticleCountById" resultType="Integer">
        select
        sum(article_count) from tb_order WHERE id=#{id} OR
        parent_order_id=#{id}
        <if test="shopMode != 5">
            and order_state not in (1,9)
        </if>
        <if test="shopMode == 5">
            and order_state != 9
        </if>
    </select>

    <select id="getLastOrderByCustomer" resultType="Order">
        select * from tb_order where customer_id = #{customerId}
        and shop_detail_id = #{shopId}
        and ((order_mode = 5 and order_state = 1  and #{time} > now() - create_time)
        or (order_mode != 5 and order_mode != 6 and #{time} > now() - create_time)
        or(order_mode = 6 ))
        and table_number is not null
        and allow_continue_order = 1
        order by create_time desc limit 1
    </select>

    <select id="checkTableNumber" resultType="java.lang.Integer">
        select count(1) from tb_order
        where shop_detail_id = #{shopId}
        and table_number = #{tableNumber}
        and pay_type = 1 and order_state = 1
        and parent_order_id is null
        and pay_type = 1
        and #{closeContinueTime} >  now() - create_time
        and customer_id != #{customerId}
    </select>

    <!--根据菜品id查找菜品库存(无规格)-->
    <select id="selectArticleCount" resultType="java.lang.Integer">
        select current_working_stock from tb_article
        where id = #{articleId}
    </select>

    <!--根据菜品id查找菜品库存(有规格)-->
    <select id="selectArticlePriceCount" resultType="java.lang.Integer">
        select current_working_stock from tb_article_price
        where id = #{articleId}
    </select>

    <update id="clearPushOrder">
        update tb_order set
        push_order_time=(NULL),production_status
        =#{1},allow_cancel=1 where
        id=#{0}
    </update>

    <select id="selectListByParentId" resultType="Order">
        select * from tb_order
        where parent_order_id=#{orderId}
    </select>

    <select id="getRefundSumByOrderId" resultType="java.math.BigDecimal">
        select sum(pay_value) from tb_order_payment_item
        where order_id = #{orderId} and payment_mode_id = #{type}
        and 0 > pay_value
    </select>

    <select id="getAliPayment" resultType="java.math.BigDecimal">
        select pay_value from tb_order_payment_item where order_id = #{orderId}
        and pay_value > 0 and payment_mode_id = 10
    </select>

    <!-- 查询 用户的新订单,如果 订单ID有值。则查询订单的详情 -->
    <select id="findCustomerNewOrder" resultType="Order">
        SELECT * from tb_order
        <if test="orderId == null or orderId == '' ">
            where customer_id=#{customerId} and shop_detail_id=#{shopId} and
            create_time > #{beginDate}
            and order_state in
            <foreach collection="orderState" item="state" open="("
                     separator="," close=")">
                #{state}
            </foreach>
            ORDER BY create_time DESC LIMIT 0,1
        </if>
        <if test="orderId != null and orderId != '' ">
            where id=#{orderId}
        </if>
    </select>

    <select id="selectChildIdsByParentIdByFive" resultType="String">
        select id from
        tb_order where parent_order_id=#{0}
        and order_state in (1,2,10,11,12)
    </select>

    <select id="selectChildIdsByParentId" resultType="String">
        select id from
        tb_order where parent_order_id=#{0}
        and order_state in (2,10,11,12)
    </select>

    <select id="selectNewCustomerPackageId" resultType="String">
        SELECT id
        FROM tb_order WHERE allow_appraise=1 AND confirm_time IS NOT NULL
        and
        customer_id=#{0} and shop_detail_id=#{1}
        ORDER BY confirm_time DESC
        LIMIT 0,1
    </select>

    <update id="setOrderNumber">
        update tb_order set table_number=#{tableNumber} where id=#{orderId}
    </update>

    <select id="getPayHoufu" resultType="java.math.BigDecimal">
        select sum(pay_value) from tb_order_payment_item
        where order_id = #{orderId} and payment_mode_id in (2,3)
    </select>

    <select id="customerByOrderForMyPage" resultMap="BaseResultMap">
        select * from tb_order where customer_id = #{customerId} and shop_detail_id = #{shopId} and
        if(order_state = 1,order_state = 1 and (43200 >= (now() - create_time)),order_state = 10 and allow_appraise = 1) order by order_state , create_time desc limit 0,1;
    </select>

    <select id="getLastOrderByTableNumber" resultType="Order">
        select * from tb_order where table_number = #{tableNumber} and order_state = 1
        and pay_mode = 2 and shop_detail_id = #{shopId}
        and
        DATE_FORMAT(NOW(),'%d %b %y') = DATE_FORMAT(create_time,'%d %b %y')
        order by create_time desc limit 1
    </select>

    <select id="selectWXOrderItems" parameterType="java.util.Map" resultMap="BaseResultMap">
        select tod.serial_number,tod.order_state,tod.production_status,push_order_time,
        print_order_time,call_number_time,order_money,topi.id orderPaymentId,topi.pay_value,topi.payment_mode_id,
        toi.article_name,(toi.orgin_count - toi.refund_count) count
        from tb_order tod
        inner join tb_order_payment_item topi on tod.id = topi.order_id
        inner join tb_order_item toi on tod.id = toi.order_id
        <where>
            <if test="serialNumber != null">
                tod.serial_number = #{serialNumber}
            </if>
            <if test="orderId != null">
                tod.id = #{orderId}
            </if>
        </where>
    </select>

    <select id="getLastOrderBySevenMode" resultType="Order">
        select * from tb_order where customer_id = #{customerId}
        and order_mode = 7 and parent_order_id is null
        order by create_time desc limit 1
    </select>

</mapper>